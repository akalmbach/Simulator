<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>planner_request: get_state.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">


</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">get_state.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="get__state_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespaceplanner__request_1_1get__state.html">00001</a> <span class="comment">#!/usr/bin/env python</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">## @package planner_request</span>
<a name="l00004"></a>00004 <span class="comment"># API for Spiri</span>
<a name="l00005"></a>00005 <span class="comment"># @author Rohan Bhargava</span>
<a name="l00006"></a>00006 <span class="comment"># @version 1.1.1</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="keyword">import</span> roslib
<a name="l00009"></a>00009 roslib.load_manifest(<span class="stringliteral">&#39;hector_uav_msgs&#39;</span>)
<a name="l00010"></a>00010 <span class="keyword">import</span> rospy
<a name="l00011"></a>00011 <span class="keyword">import</span> time
<a name="l00012"></a>00012 <span class="keyword">from</span> nav_msgs.msg <span class="keyword">import</span> Odometry
<a name="l00013"></a>00013 <span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> PoseStamped, Quaternion, Vector3,Vector3Stamped, PointStamped, Transform, Pose
<a name="l00014"></a>00014 <span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Imu,NavSatFix
<a name="l00015"></a>00015 <span class="keyword">from</span> hector_uav_msgs.msg <span class="keyword">import</span> Altimeter
<a name="l00016"></a>00016 <span class="keyword">from</span> moveit_commander <span class="keyword">import</span> MoveGroupCommander
<a name="l00017"></a>00017 <span class="comment"># to send goals</span>
<a name="l00018"></a>00018 <span class="keyword">from</span> moveit_msgs.msg <span class="keyword">import</span> Constraints, JointConstraint, RobotState
<a name="l00019"></a>00019 <span class="comment"># for conversion between datatype</span>
<a name="l00020"></a>00020 <span class="keyword">from</span> tf.transformations <span class="keyword">import</span> euler_from_quaternion
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">## Class defining all the functions to control Spiri</span>
<a name="l00023"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html">00023</a> <span class="keyword">class </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html" title="Class defining all the functions to control Spiri.">Staterobot</a>():
<a name="l00024"></a>00024 
<a name="l00025"></a>00025         <span class="comment">## Constructor</span>
<a name="l00026"></a>00026         <span class="comment">## @todo The callback needs to be called before the user can send goals.</span>
<a name="l00027"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">00027</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#ae54f70c890bd5e13ceba777ca15d37ab" title="Constructor.">__init__</a>(self):
<a name="l00028"></a>00028 
<a name="l00029"></a>00029                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">state</a>=Pose() <span class="comment">#PoseStamped()</span>
<a name="l00030"></a>00030                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a4ee414e859ec2b136f2d56f7f38d9dea">orientation</a>=Quaternion()
<a name="l00031"></a>00031                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#af6340244007b1b372f9c63d77ee0aa4f">altimeter_height</a>=0.0
<a name="l00032"></a>00032                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a38c5c4c73acd18fbdc8acc7491073e7f">pressure_height</a>=0.0
<a name="l00033"></a>00033                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#ae324c8982f5423745a35802b7eba6611">gps</a>=NavSatFix()
<a name="l00034"></a>00034                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6d1136b6c94b256b380315282f9a2427">gps_vel</a>=Vector3()
<a name="l00035"></a>00035                 rospy.init_node(<span class="stringliteral">&#39;spiri_api&#39;</span>,anonymous=<span class="keyword">True</span>)
<a name="l00036"></a>00036 
<a name="l00037"></a>00037                 rospy.Subscriber(<span class="stringliteral">&#39;/ground_truth/state&#39;</span>,Odometry,self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a4e2342427c012e4d9f6ed238a22c46af" title="Callback function for the state topic.">callback_state</a>)
<a name="l00038"></a>00038                 rospy.Subscriber(<span class="stringliteral">&#39;/raw_imu&#39;</span>,Imu,self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a9fccc00006b0437ff039020981cfb75e" title="Callback function for the imu topic.">callback_imu</a>)
<a name="l00039"></a>00039                 rospy.Subscriber(<span class="stringliteral">&#39;/altimeter&#39;</span>,Altimeter,self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a5876c51c1f3dcaa7c82566a2f8c72ef3" title="Callback function for the altimeter topic.">callback_altimeter</a>)
<a name="l00040"></a>00040                 rospy.Subscriber(<span class="stringliteral">&#39;/pressure_height&#39;</span>,PointStamped,self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a665e8599b9253b329e37a7405d578b58" title="Callback function for the pressure_height topic.">callback_pressure</a>)
<a name="l00041"></a>00041                 rospy.Subscriber(<span class="stringliteral">&#39;/fix&#39;</span>,NavSatFix,self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a698a020157969cd05e5037ada2ebc51e" title="Callback function for the fix topic.">callback_gps</a>)
<a name="l00042"></a>00042                 rospy.Subscriber(<span class="stringliteral">&#39;/fix_velocity&#39;</span>,Vector3Stamped,self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a192a190ac01b3a63d7a6f5f1d9741d5b" title="Callback function for the fix_velocity topic.">callback_gps_vel</a>)
<a name="l00043"></a>00043 
<a name="l00044"></a>00044                 time.sleep(1.0)
<a name="l00045"></a>00045 
<a name="l00046"></a>00046         <span class="comment">## Callback function for the state topic</span>
<a name="l00047"></a>00047         <span class="comment"># @param self object pointer</span>
<a name="l00048"></a>00048         <span class="comment"># @param data Contains the data published on the topic</span>
<a name="l00049"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a4e2342427c012e4d9f6ed238a22c46af">00049</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a4e2342427c012e4d9f6ed238a22c46af" title="Callback function for the state topic.">callback_state</a>(self,data):
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 
<a name="l00053"></a>00053                 <span class="comment">#self.state.pose=data.pose.pose</span>
<a name="l00054"></a>00054                 <span class="comment">#self.state.header=data.header</span>
<a name="l00055"></a>00055                 <span class="comment">#print data</span>
<a name="l00056"></a>00056                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">state</a> = data.pose.pose
<a name="l00057"></a>00057 
<a name="l00058"></a>00058         <span class="comment">## Callback function for the imu topic</span>
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a9fccc00006b0437ff039020981cfb75e">00060</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a9fccc00006b0437ff039020981cfb75e" title="Callback function for the imu topic.">callback_imu</a>(self,data):
<a name="l00061"></a>00061 
<a name="l00062"></a>00062                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a4ee414e859ec2b136f2d56f7f38d9dea">orientation</a>=data.orientation
<a name="l00063"></a>00063 
<a name="l00064"></a>00064         <span class="comment">## Callback function for the altimeter topic</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a5876c51c1f3dcaa7c82566a2f8c72ef3">00067</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a5876c51c1f3dcaa7c82566a2f8c72ef3" title="Callback function for the altimeter topic.">callback_altimeter</a>(self,data):
<a name="l00068"></a>00068                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#af6340244007b1b372f9c63d77ee0aa4f">altimeter_height</a>=data.altitude
<a name="l00069"></a>00069 
<a name="l00070"></a>00070         <span class="comment">## Callback function for the pressure_height topic</span>
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a665e8599b9253b329e37a7405d578b58">00072</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a665e8599b9253b329e37a7405d578b58" title="Callback function for the pressure_height topic.">callback_pressure</a>(self,data):
<a name="l00073"></a>00073 
<a name="l00074"></a>00074                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a38c5c4c73acd18fbdc8acc7491073e7f">pressure_height</a>=data.point.z
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="comment">## Callback function for the fix topic</span>
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a698a020157969cd05e5037ada2ebc51e">00078</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a698a020157969cd05e5037ada2ebc51e" title="Callback function for the fix topic.">callback_gps</a>(self,data):
<a name="l00079"></a>00079 
<a name="l00080"></a>00080                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#ae324c8982f5423745a35802b7eba6611">gps</a>.latitude=data.latitude
<a name="l00081"></a>00081                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#ae324c8982f5423745a35802b7eba6611">gps</a>.longitude=data.longitude
<a name="l00082"></a>00082                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#ae324c8982f5423745a35802b7eba6611">gps</a>.altitude=data.altitude
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <span class="comment">## Callback function for the fix_velocity topic</span>
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a192a190ac01b3a63d7a6f5f1d9741d5b">00087</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a192a190ac01b3a63d7a6f5f1d9741d5b" title="Callback function for the fix_velocity topic.">callback_gps_vel</a>(self,data):
<a name="l00088"></a>00088 
<a name="l00089"></a>00089                 self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6d1136b6c94b256b380315282f9a2427">gps_vel</a>=data.vector
<a name="l00090"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a36fa47a0cdecc52919af317c2172fae7">00090</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a36fa47a0cdecc52919af317c2172fae7">getstate</a>(self):
<a name="l00091"></a>00091                 <span class="comment"># this can be used internally otherwise we can return 7 values. This is useful if the use needs all the 7 values at the same timestep.</span>
<a name="l00092"></a>00092                 <span class="keywordflow">return</span> self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">state</a>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         <span class="comment">## API function to read the position x,y,z of Spiri</span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <span class="comment">## Returns an object.</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="comment">## Position can be accessed using obj.x,obj.y,obj.z</span>
<a name="l00099"></a>00099         <span class="comment"># @return Object</span>
<a name="l00100"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#ae5cae64be46c300e2700a6e7dd7a3e19">00100</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#ae5cae64be46c300e2700a6e7dd7a3e19" title="API function to read the position x,y,z of Spiri.">get_position</a>(self):
<a name="l00101"></a>00101 
<a name="l00102"></a>00102                 <span class="keywordflow">return</span> self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">state</a>.pose.position
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 
<a name="l00105"></a>00105         <span class="comment">## API function to read the orientation of Spiri</span>
<a name="l00106"></a>00106         <span class="comment">## This function gives the orientation by fusing data from IMU, GPS and other sensors</span>
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         <span class="comment">## Returns an object.</span>
<a name="l00110"></a>00110         <span class="comment">## Depending upon the format</span>
<a name="l00111"></a>00111         <span class="comment">## Euler - Orientation can be accessed using obj.x,obj.y,obj.z</span>
<a name="l00112"></a>00112         <span class="comment">## Quaternion - obj.x,obj.y,obj.z,obj.w</span>
<a name="l00113"></a>00113   <span class="comment"># @param format 1=Quaternion, 0=Euler</span>
<a name="l00114"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a7771ad2e319428a7ae3a42be60cb22e2">00114</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a7771ad2e319428a7ae3a42be60cb22e2" title="API function to read the orientation of Spiri This function gives the orientation by fusing data from...">get_orientation</a>(self,format=0):
<a name="l00115"></a>00115 
<a name="l00116"></a>00116                 <span class="keywordflow">if</span> format==1:
<a name="l00117"></a>00117 
<a name="l00118"></a>00118                         <span class="keywordflow">return</span> self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">state</a>.pose.orientation
<a name="l00119"></a>00119                 <span class="keywordflow">else</span>:
<a name="l00120"></a>00120 
<a name="l00121"></a>00121                         euler=Vector3()
<a name="l00122"></a>00122                         temp=euler_from_quaternion([self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">state</a>.orientation.x,self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">state</a>.orientation.y,self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">state</a>.orientation.z,self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6f7624ca98310fb738be2c82ae05bf19">state</a>.orientation.w])
<a name="l00123"></a>00123                         euler.x=temp[0];euler.y=temp[1];euler.z=temp[2]
<a name="l00124"></a>00124                         <span class="keywordflow">return</span> euler
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         <span class="comment">## API function to read the orientation of Spiri. This function gives the orientation reported by the IMU</span>
<a name="l00128"></a>00128 
<a name="l00129"></a>00129         <span class="comment">## Depending upon the format</span>
<a name="l00130"></a>00130         <span class="comment">## Euler - Orientation can be accessed using obj.x,obj.y,obj.z</span>
<a name="l00131"></a>00131         <span class="comment">## Quaternion - obj.x,obj.y,obj.z,obj.w</span>
<a name="l00132"></a>00132         <span class="comment"># @return object</span>
<a name="l00133"></a>00133         <span class="comment"># @param format euler=Euler quat=Quaternion</span>
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a05789da81b86c885eeac83c0bcede89b">00135</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a05789da81b86c885eeac83c0bcede89b" title="API function to read the orientation of Spiri.">get_orientation_imu</a>(self,format=&#39;euler&#39;):
<a name="l00136"></a>00136 
<a name="l00137"></a>00137           <span class="comment"># user wants it in quaternion</span>
<a name="l00138"></a>00138                 <span class="keywordflow">if</span> format==<span class="stringliteral">&#39;quat&#39;</span>:
<a name="l00139"></a>00139 
<a name="l00140"></a>00140                         <span class="keywordflow">return</span> self.orientation
<a name="l00141"></a>00141                 <span class="keywordflow">else</span>:
<a name="l00142"></a>00142 
<a name="l00143"></a>00143                         euler=Vector3()
<a name="l00144"></a>00144                         temp=euler_from_quaternion([self.state.orientation.x,self.state.orientation.y,self.state.orientation.z,self.state.orientation.w])
<a name="l00145"></a>00145                         euler.x=temp[0];euler.y=temp[1];euler.z=temp[2]
<a name="l00146"></a>00146                         <span class="keywordflow">return</span> euler
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="comment">## API function to read the altitude of Spiri. This function gives the altitude reported by the Altimeter</span>
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <span class="comment"># @return float</span>
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#acba5d4cfba7d403fa41c8cd15fdd37bd">00153</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#acba5d4cfba7d403fa41c8cd15fdd37bd" title="API function to read the altitude of Spiri.">get_height_altimeter</a>(self):
<a name="l00154"></a>00154 
<a name="l00155"></a>00155                 <span class="comment"># returns one float</span>
<a name="l00156"></a>00156                 <span class="keywordflow">return</span> self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#af6340244007b1b372f9c63d77ee0aa4f">altimeter_height</a>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <span class="comment">## API function to read the altitude of Spiri. This function gives the altitude reported by the Pressure sensor</span>
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         <span class="comment"># @return float</span>
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a7ef9385757bfaea6c9e31286398dd1d2">00163</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a7ef9385757bfaea6c9e31286398dd1d2" title="API function to read the altitude of Spiri.">get_height_pressure</a>(self):
<a name="l00164"></a>00164 
<a name="l00165"></a>00165                 <span class="comment"># return one float</span>
<a name="l00166"></a>00166                 <span class="keywordflow">return</span> self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a38c5c4c73acd18fbdc8acc7491073e7f">pressure_height</a>
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         <span class="comment">## API function to read the GPS data of Spiri. This function gives the latitude, longitude, altitude reported by the GPS</span>
<a name="l00169"></a>00169   <span class="comment">## Data can be accessed using obj.latitude, obj.longitude, obj.altitude</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171         <span class="comment"># @return object</span>
<a name="l00172"></a>00172 
<a name="l00173"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a12c447ccb786f8b3ef6a17627eb1757b">00173</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a12c447ccb786f8b3ef6a17627eb1757b" title="API function to read the GPS data of Spiri.">get_gps_data</a>(self):
<a name="l00174"></a>00174 
<a name="l00175"></a>00175                 <span class="comment"># return lat,long and height</span>
<a name="l00176"></a>00176                 <span class="keywordflow">return</span> self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#ae324c8982f5423745a35802b7eba6611">gps</a>
<a name="l00177"></a>00177 
<a name="l00178"></a>00178         <span class="comment">## API function to read the GPS velocity of Spiri. This function gives the velocity reported by the GPS.</span>
<a name="l00179"></a>00179         <span class="comment">## Data can be accessed using obj.x, obj.y, obj.z</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181         <span class="comment"># return object.</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a79da4b7d5b37ff9e63a1f275ce7045e6">00185</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a79da4b7d5b37ff9e63a1f275ce7045e6" title="API function to read the GPS velocity of Spiri.">get_gps_vel</a>(self):
<a name="l00186"></a>00186 
<a name="l00187"></a>00187                 <span class="keywordflow">return</span> self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a6d1136b6c94b256b380315282f9a2427">gps_vel</a>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189         <span class="comment">## API function to send goals to Spiri. This function will send a goal with respect to the world.</span>
<a name="l00190"></a>00190         <span class="comment">## The start position of Spiri is 0,0</span>
<a name="l00191"></a>00191         <span class="comment">## @todo Return based something on success or failure</span>
<a name="l00192"></a>00192         <span class="comment">## @todo This function should also take in GPS coordinates</span>
<a name="l00193"></a>00193         <span class="comment"># @param x  coordinate in x axis</span>
<a name="l00194"></a>00194         <span class="comment"># @param y coordinate in y axis</span>
<a name="l00195"></a>00195         <span class="comment"># @param z coordinate in z axis</span>
<a name="l00196"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a8e0ac5967abcc4612fde86cc3e91654d">00196</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a8e0ac5967abcc4612fde86cc3e91654d" title="API function to send goals to Spiri.">send_goal</a>(self,x,y,z):
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 
<a name="l00201"></a>00201                 group=MoveGroupCommander(<span class="stringliteral">&#39;spiri&#39;</span>)
<a name="l00202"></a>00202                 group.set_planner_id(<span class="stringliteral">&#39;PRMkConfigDefault&#39;</span>)
<a name="l00203"></a>00203                 <span class="comment">#group.set_workspace([-10.0,10.0,-10.0,10.0,-10.0,10.0])</span>
<a name="l00204"></a>00204                 state=self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a36fa47a0cdecc52919af317c2172fae7">getstate</a>()
<a name="l00205"></a>00205                 start_state=RobotState()
<a name="l00206"></a>00206 
<a name="l00207"></a>00207                 transform=Transform()
<a name="l00208"></a>00208                 transform.translation=state.position
<a name="l00209"></a>00209                 transform.rotation=state.orientation
<a name="l00210"></a>00210                 <span class="comment"># is this our case? Need to test</span>
<a name="l00211"></a>00211                 <span class="keywordflow">if</span> len(start_state.multi_dof_joint_state.transforms)==0:
<a name="l00212"></a>00212                         start_state.multi_dof_joint_state.transforms.append(transform)
<a name="l00213"></a>00213                         start_state.multi_dof_joint_state.joint_names.append(<span class="stringliteral">&#39;virtual_join&#39;</span>)
<a name="l00214"></a>00214                 <span class="comment"># if there are other joints in the system</span>
<a name="l00215"></a>00215                 <span class="keywordflow">else</span>:
<a name="l00216"></a>00216                         start_state.multi_dof_joint_state.transforms=[]
<a name="l00217"></a>00217                         start_state.multi_dof_joint_state.transforms.append(transform)
<a name="l00218"></a>00218                         start_state.multi_dof_joint_state.joint_names=[]
<a name="l00219"></a>00219                         start_state.multi_dof_joint_state.joint_names.append(<span class="stringliteral">&#39;virtual_join&#39;</span>)
<a name="l00220"></a>00220                 start_state.joint_state.header.frame_id=<span class="stringliteral">&#39;/nav&#39;</span>
<a name="l00221"></a>00221                 start_state.multi_dof_joint_state.header.frame_id=<span class="stringliteral">&#39;/nav&#39;</span>
<a name="l00222"></a>00222                 <span class="comment"># the start state has to be RobotState.</span>
<a name="l00223"></a>00223                 group.set_start_state(start_state)
<a name="l00224"></a>00224 
<a name="l00225"></a>00225                 <span class="comment"># goal oncly accepts a list</span>
<a name="l00226"></a>00226                 <span class="comment">#print state.orientation</span>
<a name="l00227"></a>00227                 <span class="comment">#print self.state</span>
<a name="l00228"></a>00228                 goal=[0.0,0.0,0.0,state.orientation.x,state.orientation.y,state.orientation.z,state.orientation.w]
<a name="l00229"></a>00229                 <span class="comment">#print goal</span>
<a name="l00230"></a>00230                 goal[0]=x
<a name="l00231"></a>00231                 goal[1]=y
<a name="l00232"></a>00232                 goal[2]=z
<a name="l00233"></a>00233                 group.set_joint_value_target(goal)
<a name="l00234"></a>00234                 plan=group.plan()
<a name="l00235"></a>00235 
<a name="l00236"></a>00236                 <span class="comment">#time.sleep(1.0)</span>
<a name="l00237"></a>00237                 group.execute(plan)
<a name="l00238"></a>00238                 <span class="comment"># need to return success or failure</span>
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <span class="comment">##API function to send goals to Spiri. This function will send a goal with respect to the start position.</span>
<a name="l00241"></a>00241 
<a name="l00242"></a>00242         <span class="comment">##Example-:</span>
<a name="l00243"></a>00243         <span class="comment">##Suppose Spiri is at 1,1,1 and we call this function send_gaol_relative(1,0,0).</span>
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         <span class="comment">##Spiri will move 1 m in x direction.</span>
<a name="l00246"></a>00246         <span class="comment">## @todo Return based something on success or failure</span>
<a name="l00247"></a>00247         <span class="comment"># @param x  distance in metres in x axis</span>
<a name="l00248"></a>00248         <span class="comment"># @param y  distance in metres in y axis</span>
<a name="l00249"></a>00249         <span class="comment"># @param z distance in metres in z axis</span>
<a name="l00250"></a><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a0bd7ca2bc1f416e09cb2590ae20029a1">00250</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a0bd7ca2bc1f416e09cb2590ae20029a1" title="API function to send goals to Spiri.">send_goal_relative</a>(self,x,y,z):
<a name="l00251"></a>00251 
<a name="l00252"></a>00252                 group=MoveGroupCommanderlove(<span class="stringliteral">&#39;spiri&#39;</span>)
<a name="l00253"></a>00253                 group.set_planner_id(<span class="stringliteral">&#39;PRMkConfigDefault&#39;</span>)
<a name="l00254"></a>00254                 <span class="comment">#group.set_workspace([-10.0,10.0,-10.0,10.0,-10.0,10.0])</span>
<a name="l00255"></a>00255                 state=self.<a class="code" href="classplanner__request_1_1get__state_1_1Staterobot.html#a36fa47a0cdecc52919af317c2172fae7">getstate</a>()
<a name="l00256"></a>00256                 start_state=RobotState()
<a name="l00257"></a>00257 
<a name="l00258"></a>00258                 transform=Transform()
<a name="l00259"></a>00259                 transform.translation=state.position
<a name="l00260"></a>00260                 transform.rotation=state.orientation
<a name="l00261"></a>00261                 <span class="comment"># is this our case? Need to test</span>
<a name="l00262"></a>00262                 <span class="keywordflow">if</span> len(start_state.multi_dof_joint_state.transforms)==0:
<a name="l00263"></a>00263                         start_state.multi_dof_joint_state.transforms.append(transform)
<a name="l00264"></a>00264                         start_state.multi_dof_joint_state.joint_names.append(<span class="stringliteral">&#39;virtual_join&#39;</span>)
<a name="l00265"></a>00265                 <span class="comment"># if there are other joints in the system</span>
<a name="l00266"></a>00266                 <span class="keywordflow">else</span>:
<a name="l00267"></a>00267                         start_state.multi_dof_joint_state.transforms=[]
<a name="l00268"></a>00268                         start_state.multi_dof_joint_state.transforms.append(transform)
<a name="l00269"></a>00269                         start_state.multi_dof_joint_state.joint_names=[]
<a name="l00270"></a>00270                         start_state.multi_dof_joint_state.joint_names.append(<span class="stringliteral">&#39;virtual_join&#39;</span>)
<a name="l00271"></a>00271                 start_state.joint_state.header.frame_id=<span class="stringliteral">&#39;/nav&#39;</span>
<a name="l00272"></a>00272                 start_state.multi_dof_joint_state.header.frame_id=<span class="stringliteral">&#39;/nav&#39;</span>
<a name="l00273"></a>00273                 <span class="comment"># the start state has to be RobotState.</span>
<a name="l00274"></a>00274                 group.set_start_state(start_state)
<a name="l00275"></a>00275 
<a name="l00276"></a>00276                 <span class="comment"># goal oncly accepts a list</span>
<a name="l00277"></a>00277                 <span class="comment">#print state.orientation</span>
<a name="l00278"></a>00278                 <span class="comment">#print self.state</span>
<a name="l00279"></a>00279                 goal=[0.0,0.0,0.0,state.orientation.x,state.orientation.y,state.orientation.z,state.orientation.w]
<a name="l00280"></a>00280 
<a name="l00281"></a>00281                 <span class="comment">#print goal</span>
<a name="l00282"></a>00282                 goal[0]=state.position.x+x
<a name="l00283"></a>00283                 goal[1]=state.position.y+y
<a name="l00284"></a>00284                 goal[2]=state.position.z+z
<a name="l00285"></a>00285                 group.set_joint_value_target(goal)
<a name="l00286"></a>00286                 plan=group.plan()
<a name="l00287"></a>00287 
<a name="l00288"></a>00288                 <span class="comment">#time.sleep(1.0)</span>
<a name="l00289"></a>00289                 group.execute(plan)
<a name="l00290"></a>00290                 <span class="comment"># should return something</span>
</pre></div></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/planner_request">planner_request</a><br />
Author(s): </br />
<small>autogenerated on Fri Jul 18 2014 11:59:11</small>
</div>
</body>
</html>
