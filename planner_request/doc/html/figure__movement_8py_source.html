<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>planner_request: figure_movement.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">


</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">figure_movement.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="figure__movement_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespaceplanner__request_1_1figure__movement.html">00001</a> <span class="comment">#!/usr/bin/env python</span>
<a name="l00002"></a>00002 <span class="keyword">import</span> rospy
<a name="l00003"></a>00003 <span class="keyword">import</span> roslib
<a name="l00004"></a>00004 roslib.load_manifest(<span class="stringliteral">&#39;action_controller&#39;</span>)
<a name="l00005"></a>00005 <span class="keyword">from</span> moveit_commander <span class="keyword">import</span> MoveGroupCommander
<a name="l00006"></a>00006 <span class="keyword">from</span> moveit_msgs.msg <span class="keyword">import</span> Constraints, JointConstraint, RobotState
<a name="l00007"></a>00007 <span class="keyword">from</span> action_controller.msg <span class="keyword">import</span> *
<a name="l00008"></a>00008 <span class="keyword">import</span> actionlib
<a name="l00009"></a>00009 <span class="keyword">import</span> time
<a name="l00010"></a>00010 <span class="keyword">from</span> nav_msgs.msg <span class="keyword">import</span> Odometry
<a name="l00011"></a>00011 <span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Imu
<a name="l00012"></a>00012 <span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Pose, Transform
<a name="l00013"></a>00013 <span class="keyword">from</span> planner_request <span class="keyword">import</span> figures
<a name="l00014"></a><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html">00014</a> <span class="keyword">class </span><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html">Staterobot</a>():
<a name="l00015"></a><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#acc838ec44d758bd2d1572c73c0264caf">00015</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#a55515374f53a462c7da7254240080a5d">__init__</a>(self,topic):
<a name="l00016"></a>00016                 <span class="comment">#self.position=[]</span>
<a name="l00017"></a>00017                 self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ab971293bf4b8759adca9c2f9e2639cec">state</a>=Odometry()
<a name="l00018"></a>00018                 self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ac7d466f5aacc5888ca1cd4e55c6cf960">position</a>=RobotState()
<a name="l00019"></a>00019                 self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#acc838ec44d758bd2d1572c73c0264caf">transform</a>=Transform()
<a name="l00020"></a>00020                 <span class="comment">#return position</span>
<a name="l00021"></a>00021                 rospy.Subscriber(topic,Odometry,self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#a9455dd9420eb177ac3cf6e13ccb6d09f">callback</a>)
<a name="l00022"></a><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#a9455dd9420eb177ac3cf6e13ccb6d09f">00022</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#a9455dd9420eb177ac3cf6e13ccb6d09f">callback</a>(self,data):
<a name="l00023"></a>00023                 <span class="comment">#self.state=data.pose.pose.positio</span>
<a name="l00024"></a>00024                 self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#acc838ec44d758bd2d1572c73c0264caf">transform</a>.translation=data.pose.pose.position
<a name="l00025"></a>00025                 self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#acc838ec44d758bd2d1572c73c0264caf">transform</a>.rotation=data.pose.pose.orientation              
<a name="l00026"></a>00026                 self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ab971293bf4b8759adca9c2f9e2639cec">state</a>=[data.pose.pose.position.x,data.pose.pose.position.y,data.pose.pose.position.z,data.pose.pose.orientation.x,data.pose.pose.orientation.y,data.pose.pose.orientation.z,data.pose.pose.orientation.w]
<a name="l00027"></a>00027                 <span class="keywordflow">if</span> len(self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ac7d466f5aacc5888ca1cd4e55c6cf960">position</a>.multi_dof_joint_state.transforms)==0:
<a name="l00028"></a>00028                         self.position.multi_dof_joint_state.transforms.append(self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#acc838ec44d758bd2d1572c73c0264caf">transform</a>)
<a name="l00029"></a>00029                         self.position.multi_dof_joint_state.joint_names.append(<span class="stringliteral">&#39;virtual_join&#39;</span>)
<a name="l00030"></a>00030                 <span class="keywordflow">else</span>:
<a name="l00031"></a>00031                         self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ac7d466f5aacc5888ca1cd4e55c6cf960">position</a>.multi_dof_joint_state.transforms=[]
<a name="l00032"></a>00032                         self.position.multi_dof_joint_state.transforms.append(self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#acc838ec44d758bd2d1572c73c0264caf">transform</a>)
<a name="l00033"></a>00033                         self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ac7d466f5aacc5888ca1cd4e55c6cf960">position</a>.multi_dof_joint_state.joint_names=[]
<a name="l00034"></a>00034                         self.position.multi_dof_joint_state.joint_names.append(<span class="stringliteral">&#39;virtual_join&#39;</span>)
<a name="l00035"></a>00035                 self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ac7d466f5aacc5888ca1cd4e55c6cf960">position</a>.joint_state.header.frame_id=<span class="stringliteral">&#39;/nav&#39;</span>
<a name="l00036"></a>00036                 self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ac7d466f5aacc5888ca1cd4e55c6cf960">position</a>.multi_dof_joint_state.header.frame_id=<span class="stringliteral">&#39;/nav&#39;</span>
<a name="l00037"></a>00037         
<a name="l00038"></a><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#a6f72bec6ec44915493a1bee1cf768113">00038</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#a6f72bec6ec44915493a1bee1cf768113">getposition</a>(self):
<a name="l00039"></a>00039                 <span class="keywordflow">return</span> self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ac7d466f5aacc5888ca1cd4e55c6cf960">position</a>    
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#a62eaf55852cb00b185c0465c045445b5">00041</a>         <span class="keyword">def </span><a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#a62eaf55852cb00b185c0465c045445b5">getstate</a>(self):
<a name="l00042"></a>00042                 <span class="keywordflow">return</span> self.<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html#ab971293bf4b8759adca9c2f9e2639cec">state</a>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 obj=<a class="code" href="classplanner__request_1_1figure__movement_1_1Staterobot.html">Staterobot</a>(<span class="stringliteral">&#39;/ground_truth/state&#39;</span>)
<a name="l00045"></a>00045 counter=0
<a name="l00046"></a>00046 waygoals=[]
<a name="l00047"></a>00047 goal=[]
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="namespaceplanner__request_1_1figure__movement.html#a6b442c0032157dc8f888ca788cb59b3d">00050</a> <span class="keyword">def </span><a class="code" href="namespaceplanner__request_1_1figure__movement.html#a6b442c0032157dc8f888ca788cb59b3d">callback</a>(data):
<a name="l00051"></a>00051         <span class="comment">#print &#39;inside the callback&#39;</span>
<a name="l00052"></a>00052         
<a name="l00053"></a>00053         <span class="keyword">global</span> counter
<a name="l00054"></a>00054         <span class="keyword">global</span> waygoals
<a name="l00055"></a>00055         <span class="keyword">global</span> goal
<a name="l00056"></a>00056         t=data.status
<a name="l00057"></a>00057         group=MoveGroupCommander(<span class="stringliteral">&#39;spiri&#39;</span>)
<a name="l00058"></a>00058         group.set_planner_id(<span class="stringliteral">&#39;PRMkConfigDefault&#39;</span>)
<a name="l00059"></a>00059         
<a name="l00060"></a>00060         <span class="comment">#goal=group.get_current_joint_values()</span>
<a name="l00061"></a>00061         <span class="comment">#print t.status </span>
<a name="l00062"></a>00062         if(t.status==3):
<a name="l00063"></a>00063                 counter=counter+1
<a name="l00064"></a>00064                 time.sleep(1)
<a name="l00065"></a>00065                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;completed&#39;</span>+str(counter)+<span class="stringliteral">&#39;goal&#39;</span>
<a name="l00066"></a>00066                 <span class="comment"># this is a robot state message                 </span>
<a name="l00067"></a>00067                 start=obj.getposition()
<a name="l00068"></a>00068                 group.set_start_state(start)
<a name="l00069"></a>00069         
<a name="l00070"></a>00070                 <span class="comment">#goal=group.get_current_joint_values()</span>
<a name="l00071"></a>00071                 <span class="comment">#print start</span>
<a name="l00072"></a>00072                 <span class="comment"># a list</span>
<a name="l00073"></a>00073                 
<a name="l00074"></a>00074                 <span class="keywordflow">if</span> counter==1:
<a name="l00075"></a>00075                         goal=obj.getstate()
<a name="l00076"></a>00076                         waygoals=figures.square_compute_vertical((goal[0],goal[1],goal[2]),(goal[0]+2,goal[1]+2,goal[2]+2),<span class="stringliteral">&#39;x&#39;</span>)
<a name="l00077"></a>00077                         <span class="comment">#waygoals=figures.vertical_sine_wave((goal[0],goal[1],goal[2]),axis=&#39;x&#39;)                </span>
<a name="l00078"></a>00078                         <span class="comment">#waygoals=figures.square_compute((goal[0],goal[1],goal[2]))             </span>
<a name="l00079"></a>00079                 <span class="comment">#goal_1=goal</span>
<a name="l00080"></a>00080                 <span class="comment">#print &#39;waygoal&#39;,waygoals</span>
<a name="l00081"></a>00081                 goal[0]=waygoals[counter-1][0]
<a name="l00082"></a>00082                 goal[1]=waygoals[counter-1][1]
<a name="l00083"></a>00083                 goal[2]=waygoals[counter-1][2]
<a name="l00084"></a>00084                 <span class="comment">#group.set_start_state(goal)            </span>
<a name="l00085"></a>00085                 <span class="comment">#goal[0]=goal[0]+2.0</span>
<a name="l00086"></a>00086                 <span class="keywordflow">print</span> goal[0],goal[1],goal[2]
<a name="l00087"></a>00087         
<a name="l00088"></a>00088                 group.set_joint_value_target(goal)
<a name="l00089"></a>00089                 plan=group.plan()
<a name="l00090"></a>00090                 <span class="comment">#time.sleep(2.0)</span>
<a name="l00091"></a>00091                 group.execute(plan)
<a name="l00092"></a>00092                 <span class="keywordflow">if</span> counter==len(waygoals):
<a name="l00093"></a>00093                         rospy.signal_shutdown(<span class="stringliteral">&#39;completed the figure&#39;</span>)
<a name="l00094"></a>00094                         
<a name="l00095"></a>00095         if(t.status==2):
<a name="l00096"></a>00096                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;timeout&#39;</span>
<a name="l00097"></a>00097                 
<a name="l00098"></a><a class="code" href="namespaceplanner__request_1_1figure__movement.html#a48fcb516701b991f945887aab6253832">00098</a> <span class="keyword">def </span><a class="code" href="namespaceplanner__request_1_1figure__movement.html#a48fcb516701b991f945887aab6253832">callback_imu</a>(data):
<a name="l00099"></a>00099         <span class="keyword">global</span> obj
<a name="l00100"></a>00100         <span class="keywordflow">print</span> obj.getstate()
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="namespaceplanner__request_1_1figure__movement.html#a8d154618e3847d3ac79fba1f4471274e">00103</a> <span class="keyword">def </span><a class="code" href="namespaceplanner__request_1_1figure__movement.html#a8d154618e3847d3ac79fba1f4471274e">listener</a>():
<a name="l00104"></a>00104         
<a name="l00105"></a>00105         rospy.init_node(<span class="stringliteral">&#39;spiri_goal&#39;</span>,anonymous=<span class="keyword">True</span>)
<a name="l00106"></a>00106         
<a name="l00107"></a>00107         <span class="comment">#print obj.getstate()</span>
<a name="l00108"></a>00108         rospy.Subscriber(<span class="stringliteral">&#39;multi_dof_joint_trajectory_action/result&#39;</span>,MultiDofFollowJointTrajectoryActionResult,callback)
<a name="l00109"></a>00109         
<a name="l00110"></a>00110         <span class="comment">#rospy.Subscriber(&#39;/raw_imu&#39;,Imu,callback_imu)  </span>
<a name="l00111"></a>00111         <span class="keywordflow">try</span>:
<a name="l00112"></a>00112         
<a name="l00113"></a>00113                 rospy.spin()
<a name="l00114"></a>00114         <span class="keywordflow">except</span> KeyboardInterrupt:
<a name="l00115"></a>00115                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;shutting down&#39;</span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="keywordflow">if</span> __name__==<span class="stringliteral">&#39;__main__&#39;</span>:
<a name="l00119"></a>00119         <a class="code" href="namespaceplanner__request_1_1figure__movement.html#a8d154618e3847d3ac79fba1f4471274e">listener</a>()
<a name="l00120"></a>00120         <span class="comment">#group=MoveGroupCommander(&#39;spiri&#39;)</span>
<a name="l00121"></a>00121         <span class="comment">#group.set_planner_id(&#39;PRMkConfigDefault&#39;)</span>
<a name="l00122"></a>00122         <span class="comment">#goal=obj.getstate()</span>
<a name="l00123"></a>00123         <span class="comment">#goal_2=RobotState()</span>
<a name="l00124"></a>00124         
<a name="l00125"></a>00125         <span class="comment">#t=Transform()</span>
<a name="l00126"></a>00126         <span class="comment">#t.translation.z=1.0</span>
<a name="l00127"></a>00127         <span class="comment">#goal_2.multi_dof_joint_state.transforms.append(t)</span>
<a name="l00128"></a>00128         <span class="comment">#goal_2.multi_dof_joint_state.joint_names.append(&#39;virtual_join&#39;)</span>
<a name="l00129"></a>00129         <span class="comment">#goal_2.multi_dof_joint_state.header.frame_id=&#39;/nav&#39;</span>
<a name="l00130"></a>00130         <span class="comment">#goal_2.joint_state.header.frame_id=&#39;/nav&#39;</span>
<a name="l00131"></a>00131         <span class="comment">#print goal_2</span>
<a name="l00132"></a>00132         <span class="comment">#print group.get_random_joint_values()  </span>
<a name="l00133"></a>00133         <span class="comment">#group.set_start_state(goal_2)</span>
<a name="l00134"></a>00134         <span class="comment">#goal=group.get_current_joint_values()</span>
<a name="l00135"></a>00135         <span class="comment">#goal[0]=1.0</span>
<a name="l00136"></a>00136         <span class="comment">#goal[2]=1.0</span>
<a name="l00137"></a>00137         <span class="comment">#group.set_joint_value_target(goal)</span>
<a name="l00138"></a>00138         <span class="comment">#group.plan()</span>
<a name="l00139"></a>00139                 
<a name="l00140"></a>00140                 
</pre></div></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/planner_request">planner_request</a><br />
Author(s): </br />
<small>autogenerated on Fri Jul 18 2014 11:59:11</small>
</div>
</body>
</html>
